#!include travel_times.yaml

# Improve with https://github.com/bah2830/Home-Assistant-Configs/blob/master/includes/automation/notifications.yaml

- platform: google_travel_time
  name: Kyle Work Travel
  api_key: !secret google_api
  origin: device_tracker.bagpuss_a0001
  destination: zone.kyle_work

- platform: google_travel_time
  name: Charlotte Work Travel
  api_key: !secret google_api
  origin: zone.home
  destination: zone.charlotte_work

- platform: google_travel_time
  name: Kyle To Home
  api_key: !secret google_api
  origin: device_tracker.bagpuss_a0001
  destination: zone.home

- platform: google_travel_time
  name: Charlotte To Home
  api_key: !secret google_api
  origin: device_tracker.charlotte_thea
  destination: zone.home

- platform: template
  sensors:
    next_bin:
      value_template: "{{ states.calendar.next_bin.attributes.message }}"
      friendly_name: Next Bin
      entity_id: calendar.next_bin

- platform: template
  sensors:
    kyle_status:
      value_template: '{{ states.input_select.kyle_status_dropdown.state }}'
      friendly_name: 'Kyle'
      entity_id: input_select.kyle_status_dropdown

- platform: template
  sensors:
    charlotte_status:
      value_template: '{{ states.input_select.charlotte_status_dropdown.state }}'
      friendly_name: 'Charlotte'
      entity_id: input_select.charlotte_status_dropdown

# Hue motion sensor breakout
- platform: template
  sensors:
    living_room_temperature:
      friendly_name: 'Living room temperature'
      value_template: '{{states.sensor.living_room_motion_hue.attributes.temperature}}'
      unit_of_measurement: °C

    living_room_light_level:
      friendly_name: 'Living room light level'
      value_template: '{{states.sensor.living_room_motion_hue.attributes.lux}}'
      unit_of_measurement: lux 

## Weather ##
- platform: yr

- platform: darksky
  api_key: !secret darksky_api_key
  scan_interval: 300
  monitored_conditions:
    - summary
    - precip_type
    - precip_intensity
    - precip_probability
    - temperature
    - apparent_temperature
    - dew_point
    - wind_speed
    - wind_bearing
    - cloud_cover
    - humidity
    - pressure
    - visibility
    - ozone
    - minutely_summary
    - hourly_summary
    - daily_summary
    - temperature_max
    - temperature_min
    - apparent_temperature_max
    - apparent_temperature_min
    - precip_intensity_max

## RFXcom ##

- platform: rfxtrx
  automatic_add: True
  devices:
    115a0100e452000000046600006462cb3e79:
      name: Electricity

- platform: alpha_vantage
  api_key: !secret alpha_vantage_key
  scan_interval: 300
  symbols: 
    - BTC
    - TMO

- platform: blockchain
  addresses:
    - !secret btc_wallet_1
    - !secret btc_wallet_2
    - !secret btc_wallet_3
    - !secret btc_wallet_4
    - !secret btc_wallet_5
    - !secret btc_wallet_6

## MQTT ## 

# Weather #
- platform: mqtt
  state_topic: "weatherstation"
  name: "Weather station temperature"
  unit_of_measurement: "°C"
  value_template: "{{ value_json.temperature }}"
- platform: mqtt
  state_topic: "weatherstation"
  name: "Weather station relative humidity"
  unit_of_measurement: "%"
  value_template: "{{ value_json.relhumidity }}"
- platform: mqtt
  state_topic: "weatherstation"
  name: "Weather station wind velocity"
  unit_of_measurement: "m/s"
  value_template: "{{ value_json.windvelocity }}"
- platform: mqtt
  state_topic: "weatherstation"
  name: "Weather station wind maximum"
  unit_of_measurement: "m/s"
  value_template: "{{ value_json.windmaximum }}"
- platform: mqtt
  state_topic: "weatherstation"
  name: "Weather station wind direction"
  unit_of_measurement: ""
  value_template: "{{ value_json.winddirection }}"
- platform: mqtt
  state_topic: "weatherstation"
  name: "Weather station rainfall"
  unit_of_measurement: "mm"
  value_template: "{{ value_json.rain }}"


# Master Bedroom #
- platform: mqtt
  state_topic: "devices/5ccf7fd8d915/FSR1/voltage"
  hidden: true
  name: "Bed Sensor 1"

- platform: mqtt
  state_topic: "devices/5ccf7fd8d915/FSR2/voltage"
  hidden: true
  name: "Bed Sensor 2"

- platform: mqtt
  state_topic: "devices/5ccf7fd8d915/$stats/signal"
  name: "Bed Sensor Signal Level"
  availability_topic: "devices/5ccf7fd8d915/$online"
  payload_available: "true"
  payload_not_available: "false"

# Garage # 
- platform: mqtt
  state_topic: "devices/5ccf7f115d5f/Temp0/degrees"
  name: Carport temperature
  unit_of_measurement: "°C"
  availability_topic: "devices/5ccf7f115d5f/$online"
  payload_available: "true"
  payload_not_available: "false"
- platform: mqtt
  state_topic: "devices/5ccf7f115d5f/Temp1/degrees"
  name: Garage temperature
  unit_of_measurement: "°C"
- platform: mqtt
  state_topic: "devices/5ccf7f115d5f/$stats/signal"
  name: "Garage ESP8266 Signal Level"
  unit_of_measurement: "%"
- platform: mqtt
  state_topic: "devices/5ccf7fe9b845/$stats/signal"
  name: "Garage Lights Signal Level"
  unit_of_measurement: "%"

# Kitchen #
- platform: mqtt
  # Start of string
  state_topic: "devices/18fe34d5323e/Temp1/degrees"
  name: Kitchen temperature
  unit_of_measurement: "°C"
  availability_topic: "devices/18fe34d5323e/$online"
  payload_available: "true"
  payload_not_available: "false"
#- platform: mqtt
   # Middle of string
#  state_topic: "devices/18fe34d5323e/Temp0/degrees"
#  name: Utility room temperature
#  unit_of_measurement: "°C"
#- platform: mqtt
   # End of string
#  state_topic: "devices/18fe34d5323e/Temp2/degrees"
#  name: Utility room temperature
#  unit_of_measurement: "°C"


- platform: mqtt
  state_topic: "devices/18fe34d5323e/$stats/signal"
  name: "Kitchen ESP8266 Signal Level"
  unit_of_measurement: "%"
  force_update: true

- platform: mqtt
  state_topic: "devices/5ccf7faf630b/$stats/signal"
  name: "Driveway Floodlights Signal Level"
  unit_of_measurement: "%" 
  force_update: true

- platform: mqtt
  state_topic: "devices/60019416854d/$stats/signal"
  name: "Front Door Floodlights Signal Level"
  unit_of_measurement: "%" 
  force_update: true

- platform: mqtt
  state_topic: "devices/5ccf7faf5486/$stats/signal"
  name: "Back floodlights Signal Level"
  unit_of_measurement: "%" 
  force_update: true


# Study #
- platform: mqtt
  state_topic: "devices/5ccf7fd9283a/temperature/degrees"    
  name: Study temperature
  unit_of_measurement: "°C"
  availability_topic: "devices/5ccf7fd9283a/$online"
  payload_available: "true"
  payload_not_available: "false"
- platform: mqtt
  state_topic: "devices/5ccf7fd9283a/humidity/percent"
  name: Study humidity
  unit_of_measurement: "%" 
- platform: mqtt
  state_topic: "devices/5ccf7fd9283a/$stats/signal"
  name: "Study ESP8266 Signal Level"
  unit_of_measurement: "%" 
  force_update: true

# Hallway #
- platform: mqtt
  state_topic: "devices/5ccf7f115e3f/temperature/degrees"    
  name: Hallway temperature
  unit_of_measurement: "°C"
  availability_topic: "devices/5ccf7115e3f/$online"
  payload_available: "true"
  payload_not_available: "false"
- platform: mqtt
  state_topic: "devices/5ccf7f115e3f/humidity/percent"
  name: Hallway humidity
  unit_of_measurement: "%"
- platform: mqtt
  state_topic: "devices/5ccf7f115e3f/$stats/signal"
  name: "Hallway ESP8266 Signal Level"
  unit_of_measurement: "%"
  force_update: true

# Utility Room #
- platform: mqtt
  state_topic: "devices/5ccf7fd9262d/temperature/degrees"
  name: Utility room temperature
  unit_of_measurement: "°C"
  availability_topic: "devices/5ccf7fd9262d/$online"
  payload_available: "true"
  payload_not_available: "false"
- platform: mqtt
  state_topic: "devices/5ccf7fd9262d/humidity/percent"    
  name: Utility room humidity
  unit_of_measurement: "%"
- platform: mqtt
  state_topic: "devices/5ccf7fd9262d/$stats/signal"
  name: "Utility Room ESP8266 Signal Level"
  unit_of_measurement: "%"
  force_update: true

- platform: mqtt
  state_topic: "owntracks/bagpuss/a0001"
  name: "Kyle Oneplus One Battery"
  unit_of_measurement: "%"
  value_template: "{{ value_json.batt }}"

- platform: nut
  name: Loft UPS
  host: 172.24.32.6
  alias: APC1000
  resources:
    - ups.load
    - ups.temperature
    - ups.status
    - ups.test.result
    - input.voltage
    - battery.runtime
    - battery.voltage

- platform: nut
  name: ES700G UPS
  host: 172.24.32.6
  alias: ES700G
  resources:
    - ups.load
    - ups.temperature
    - ups.status
    - ups.test.result
    - input.voltage
    - battery.runtime
    - battery.voltage


- platform: min_max
  name: House Average
  type: mean
  entity_ids:
    - sensor.kitchen_temperature
    - sensor.utility_room_temperature
    - sensor.study_temperature
    - sensor.hallway_temperature

- platform: min_max
  name: House Average Humidity
  type: mean
  entity_ids:
    - sensor.utility_room_humidity
    - sensor.study_humidity
    - sensor.hallway_humidity
