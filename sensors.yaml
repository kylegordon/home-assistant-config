---
template:
  - sensor:
      - name: Last Alexa
        unique_id: last_alexa
        state: >
          {{ states.media_player | selectattr('attributes.last_called','eq',True) | map(attribute='entity_id') | first }}

      - name: Next Bin
        unique_id: next_bin
        state: "{{ states.calendar.east_renfrewshire_council.attributes.message }}"

      - name: Kyle
        unique_id: kyle_status
        state: '{{ states.input_select.kyle_status_dropdown.state }}'

      - name: Charlotte
        unique_id: charlotte_status
        state: '{{ states.input_select.charlotte_status_dropdown.state }}'

sensor:

- platform: integration
  source: sensor.elec2_cm119_160_db_92_instantaneous_power
  name: energy_spent
  unit_prefix: k
  round: 2
- platform: integration
  source: sensor.tv_power_plug_power
  name: energy_spent_tv
  unit_prefix: k
  round: 2
- platform: integration
  source: sensor.shower_power_plug_power
  name: energy_spent_shower
  unit_prefix: k
  round: 2

- platform: min_max
  name: Average External Light Level
  unique_id: average_external_light_level
  type: median
  entity_ids:
    - sensor.lux_meter_1_level
    - sensor.lux_meter_2_level
    - sensor.lux_meter_3_level

- platform: min_max
  name: House Average Temperature
  unique_id: house_average_temperature
  type: mean
  entity_ids:
    - sensor.front_hall_lywsd03mmc_temperature
    - sensor.kitchen_temperature
    - sensor.craft_room_multi_sensor_temperature
    - sensor.living_room_multi_sensor_temperature
    - sensor.master_bedroom_multi_sensor_temperature
    - sensor.nook_multi_sensor_temperature
    - sensor.hallway_multi_sensor_temperature
    - sensor.study_multi_sensor_temperature
    - sensor.study_lywsd03mmc_temperature
    - sensor.bathroom_multi_sensor_temperature
    - sensor.ensuite_lywsd03mmc_temperature

- platform: min_max
  name: Rest of House Average Temperature
  unique_id: rest_of_house_average_temperature
  type: mean
  entity_ids:
    - sensor.master_bedroom_multi_sensor_temperature
    - sensor.bathroom_multi_sensor_temperature
    - sensor.ensuite_lywsd03mmc_temperature

- platform: min_max
  name: House Average Humidity
  unique_id: house_average_humidity
  type: median
  entity_ids:
    - sensor.front_hall_lywsd03mmc_humidity
    - sensor.craft_room_multi_sensor_humidity
    - sensor.guest_room_multi_sensor_humidity
    - sensor.living_room_multi_sensor_humidity
    - sensor.master_bedroom_multi_sensor_humidity
    - sensor.nook_multi_sensor_humidity
    - sensor.hallway_multi_sensor_humidity
    - sensor.study_multi_sensor_humidity
    - sensor.study_lywsd03mmc_humidity
    - sensor.bathroom_multi_sensor_humidity
    - sensor.ensuite_lywsd03mmc_humidity

- platform: min_max
  name: Study Average Temperature
  unique_id: study_average_temperature
  type: median
  entity_ids:
    - sensor.study_lywsd03mmc_temperature
    - sensor.study_multi_sensor_temperature


- platform: time_date
  display_options:
    - 'time'

- platform: template
  sensors:
    time_of_day:
      unique_id: time_of_day
      value_template: >
        {% set current_hour = strptime(states('sensor.time'), "%H:%M").hour %}
        {% if 6 <= current_hour < 9 %}
          Morning
        {% elif 9 <= current_hour < 22 %}
          Day
        {% else %}
          Night
        {% endif %}

    forecast_2_hours:
      value_template: "{{state_attr('weather.openweathermap', 'forecast')[2].temperature}}"
    forecast_4_hours:
      value_template: "{{state_attr('weather.openweathermap', 'forecast')[4].temperature}}"
    forecast_6_hours:
      value_template: "{{state_attr('weather.openweathermap', 'forecast')[6].temperature}}"
    forecast_8_hours:
      value_template: "{{state_attr('weather.openweathermap', 'forecast')[8].temperature}}"
    forecast_10_hours:
      value_template: "{{state_attr('weather.openweathermap', 'forecast')[10].temperature}}"
    forecast_12_hours:
      value_template: "{{state_attr('weather.openweathermap', 'forecast')[12].temperature}}"

    house_target_temperature:
      value_template: "{{state_attr('climate.rest_of_house_thermostat', 'temperature')}}"

- platform: thermal_comfort
  sensors:
    living_room:
      friendly_name: Living Room
      unique_id: living_room_thermal_comfort
      temperature_sensor: sensor.living_room_multi_sensor_temperature
      humidity_sensor: sensor.living_room_multi_sensor_humidity
    dining_nook:
      friendly_name: Dining Nook
      unique_id: dining_nook_thermal_comfort
      temperature_sensor: sensor.nook_multi_sensor_temperature
      humidity_sensor: sensor.nook_multi_sensor_humidity
    hall:
      friendly_name: Hall
      unique_id: hall_thermal_comfort
      temperature_sensor: sensor.hall_multi_sensor_temperature
      humidity_sensor: sensor.hall_multi_sensor_humidity
    bathroom:
      friendly_name: Bathroom
      unique_id: bathroom_thermal_comfort
      temperature_sensor: sensor.bathroom_multi_sensor_temperature
      humidity_sensor: sensor.bathroom_multi_sensor_humidity
    front_hall:
      friendly_name: Front Hall
      unique_id: front_hall_thermal_comfort
      temperature_sensor: sensor.front_hall_lywsd03mmc_temperature
      humidity_sensor: sensor.front_hall_lywsd03mmc_humidity
    craft_room:
      friendly_name: Craft Room
      unique_id: craft_room_thermal_comfort
      temperature_sensor: sensor.craft_room_multi_sensor_temperature
      humidity_sensor: sensor.craft_room_multi_sensor_humidity
    study:
      friendly_name: Study
      unique_id: study_thermal_comfort
      temperature_sensor: sensor.study_multi_sensor_temperature
      humidity_sensor: sensor.study_multi_sensor_humidity
    guest_room:
      friendly_name: Guest Room
      unique_id: guest_room_thermal_comfort
      temperature_sensor: sensor.guest_room_multi_sensor_temperature
      humidity_sensor: sensor.guest_room_multi_sensor_humidity
    master_bedroom:
      friendly_name: Master Bedroom
      unique_id: master_bedroom_thermal_comfort
      temperature_sensor: sensor.master_bedroom_temperature
      humidity_sensor: sensor.master_bedroom_humidity
