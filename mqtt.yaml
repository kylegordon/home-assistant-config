---
sensor:

  # Weather #
  - name: "Weather station temperature"
    state_topic: "weatherstation"
    unit_of_measurement: "Â°C"
    value_template: "{{ value_json.temperature }}"
  - name: "Weather station relative humidity"
    state_topic: "weatherstation"
    unit_of_measurement: "%"
    value_template: "{{ value_json.relhumidity }}"
  - name: "Weather station wind velocity"
    state_topic: "weatherstation"
    unit_of_measurement: "m/s"
    value_template: "{{ value_json.windvelocity }}"
  - name: "Weather station wind maximum"
    state_topic: "weatherstation"
    unit_of_measurement: "m/s"
    value_template: "{{ value_json.windmaximum }}"
  - name: "Weather station wind direction"
    state_topic: "weatherstation"
    unit_of_measurement: ""
    value_template: "{{ value_json.winddirection }}"
  - name: "Weather station rainfall"
    state_topic: "weatherstation"
    unit_of_measurement: "mm"
    value_template: "{{ value_json.rain }}"

  - name: "Kyle Oneplus One Battery"
    state_topic: "owntracks/bagpuss/a0001"
    unit_of_measurement: "%"
    value_template: "{{ value_json.batt }}"

binary_sensor:
  - name: Charlotte Bed Sensor
    device_class: occupancy
    state_topic: "devices/5ccf7fd8d915/Contact1/state"
    payload_on: "1"
    payload_off: "0"

  - name: Kyle Bed Sensor
    device_class: occupancy
    state_topic: "devices/5ccf7fd8d915/Contact2/state"
    payload_on: "1"
    payload_off: "0"

  - name: "Kyle Driving"
    state_topic: "driving/mode/kyle"
    payload_on: "true"
    payload_off: "false"

  - name: "Charlotte Driving"
    state_topic: "driving/mode/charlotte"
    payload_on: "true"
    payload_off: "false"

switch:
  - name: Octoprint Relay 1
    unique_id: octoprint_relay_1
    command_topic: "octoprint/usb_relay_1/set"
    payload_on: 'true'
    payload_off: 'false'

  - name: Octoprint Relay 2
    unique_id: octoprint_relay_2
    command_topic: "octoprint/usb_relay_2/set"
    payload_on: 'true'
    payload_off: 'false'

camera:
  - name: Back Door Last Person
    topic: frigate/back_door/person/snapshot
  - name: Front Door Last Person
    topic: frigate/front_door/person/snapshot
  - name: Driveway Last Person
    topic: frigate/driveway/person/snapshot
  - name: Driveway Last Car
    topic: frigate/driveway/car/snapshot
  - name: octoPrint camera
    topic: octoPrint/camera

# eBUS control info lifted from https://community.home-assistant.io/t/mqtt-climate-card-broken-for-temperature-changes-ebusd/656133
# Need to monitor various modes and presets, populate accordingly
climate:
  - name: Hot Water (eBUS)
    unique_id: ebus_hot_water
    max_temp: 100
    min_temp: 20
    precision: 0.5
    temp_step: 1
    modes:
      - auto
      - heat
      - 'off'
    mode_state_template: >-
      {% set values = { 'auto':'auto',  'day':'heat', 'off':'off'} %}
      {{ values[value] if value in values.keys() else 'off' }}
    mode_state_topic: "ebusd/basv/HwcOpMode"
    mode_command_template: >-
      {% set values = { 'auto':'auto', 'heat':'day', 'off':'off'} %}
      {{ values[value] if value in values.keys() else 'auto' }}
    mode_command_topic: "ebusd/basv/HwcOpMode/set"
    temperature_state_topic: "ebusd/basv/HwcTempDesired"
    temperature_state_template: "{{ value_json.tempv.value }}"
    # temperature_low_state_topic: "ebusd/basv/z1NightTemp"
    temperature_high_state_topic: "ebusd/basv/HwcTempDesired"
    temperature_high_state_template: "{{ value_json.tempv.value }}"
    # temperature_low_command_topic: "ebusd/basv/z1NightTemp/set"
    temperature_high_command_topic: "ebusd/basv/HwcTempDesired/set"
    # temperature_high_command_template: "{{ value_json }}"
    current_temperature_topic: "ebusd/basv/HwcStorageTemp"
    current_temperature_template: "{{ value_json.tempv.value }}"

    # The following climate entity requires that within the ebus service config
    # ebusd-2.1.x/en/vaillant/15.700.csv be modified such that Z1ActualRoomTempDesired
    # has the value 020103002200 instead of 020003001400, or 2200 instead of 1400
  - name: Heating (eBUS)
    unique_id: ebus_heating
    modes:
      - 'off'
      - 'auto'
    mode_state_template: >-
      {% set values = { 'day':'auto', 'off':'off'} %}
      {% set value = value_json.opmode.value %}
      {{ values[value] if value in values.keys() else 'off' }}
    mode_state_topic: "ebusd/basv/z1OpMode"
    mode_command_template: >-
      {% set values = { 'auto':'day', 'off':'off'} %}
      {{ values[value] if value in values.keys() else 'auto' }}
    mode_command_topic: "ebusd/basv/z1OpMode/set"
    current_temperature_topic: "ebusd/basv/z1RoomTemp"
    current_temperature_template: "{{ value_json.tempv.value }}"
    temperature_command_topic: "ebusd/basv/z1ActualRoomTempDesired/set"
    temperature_state_topic: "ebusd/basv/z1ActualRoomTempDesired"
    temperature_state_template: "{{ value_json.tempv.value }}"
    min_temp: 5
    max_temp: 30
    temp_step: 0.5
    precision: 0.1
