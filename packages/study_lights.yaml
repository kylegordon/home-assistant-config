---
automation:
  - alias: Study light toggle
    id: study_light_toggle
    mode: parallel
    # Can be improved, examples at https://github.com/TheFes/HA-configuration/blob/main/include/automation/01_first_floor/floris/shelly_floris.yaml
    trigger:
      - platform: event
        event_type: esphome.tx_ultimate_easy
        event_data:
          device_name: study_lightswitch
          action: click
    action:
      - service: light.turn_on
        data:
          entity_id: light.study_lightswitch_lights_all
          effect: "Rainbow - Fast"
      - service: switch.turn_on
        entity_id: switch.study_lightswitch_relay_1
      - choose:
          - conditions:
              - condition: or
                conditions:
                  - condition: state
                    entity_id: light.study_lights
                    state: 'on'
                  - condition: state
                    entity_id: light.monitor_rgbww_lights
                    state: 'on'
            sequence:
              - service: light.turn_off
                entity_id:
                  - light.study_lights
                  - light.monitor_rgbww_lights
        default:
          - service: light.turn_on
            entity_id:
              - light.study_lights
              - light.monitor_rgbww_lights
      - service: logbook.log
        data:
          name: EVENT
          message: "Toggling study light"
      - delay: "00:00:05"
      - service: light.turn_off
        target:
          entity_id: light.study_lightswitch_lights_all
        data:
          transition: 1

  - alias: Study decorative light toggle
    id: study_decorative_toggle
    mode: parallel
    # Can be improved, examples at https://github.com/TheFes/HA-configuration/blob/main/include/automation/01_first_floor/floris/shelly_floris.yaml
    trigger:
      - platform: event
        event_type: esphome.tx_ultimate_easy
        event_data:
          device_name: study_lightswitch
          action: double_click
    action:
      - service: light.turn_on
        data:
          entity_id: light.study_lightswitch_lights_all
          effect: "Rainbow - Fast"
      - choose:
          - conditions:
              - condition: or
                conditions:
                  - condition: state
                    entity_id: light.study_bead_lights_usb_switch_relay_3
                    state: 'on'
                  - condition: state
                    entity_id: light.monitor_rgbww_lights
                    state: 'on'
            sequence:
              - service: light.turn_off
                entity_id:
                  - light.study_bead_lights_usb_switch_relay_3
                  - light.monitor_rgbww_lights
        default:
          - service: light.turn_on
            entity_id:
              - light.study_bead_lights_usb_switch_relay_3
              - light.monitor_rgbww_lights
      - service: logbook.log
        data:
          name: EVENT
          message: "Toggling decorative study lights"
      - delay: "00:00:05"
      - service: light.turn_off
        target:
          entity_id: light.study_lightswitch_lights_all
        data:
          transition: 1

  - alias: 'Increase brightness of lamp from dimmer'
    id: increase_brightness_of_lamp_from_dimmer
    initial_state: 'on'
    trigger:
      - platform: mqtt
        topic: zigbee2mqtt/Study Wireless Dimmer Dial/action
        payload: 'brightness_move_up'
    action:
      - service: light.turn_on
        data:
          entity_id: light.study
          transition: 1
          brightness_step_pct: 10

  - alias: 'Decrease brightness of lamp from dimmer'
    id: decrease_brightness_of_lamp_from_dimmer
    initial_state: 'on'
    trigger:
      - platform: mqtt
        topic: zigbee2mqtt/Study Wireless Dimmer Dial/action
        payload: 'brightness_move_down'
    action:
      - service: light.turn_on
        data:
          entity_id: light.study
          transition: 1
          brightness_step_pct: -10
