---

homeassistant:
  customize:
    input_boolean.vacuum_fronthall:
      room_id: "8"
    input_boolean.vacuum_livingroom:
      room_id: "6"
    input_boolean.vacuum_bootroom:
      room_id: "1"
    input_boolean.vacuum_kitchen:
      room_id: "10"
    input_boolean.vacuum_hallway:
      room_id: "5"
    input_boolean.vacuum_bathroom:
      room_id: "12"
    input_boolean.vacuum_study:
      room_id: "7"
    input_boolean.vacuum_craftroom:
      room_id: "4"
    input_boolean.vacuum_guestroom:
      room_id: "9"
    input_boolean.vacuum_bedroom:
      room_id: "2"
    input_boolean.vacuum_ensuite:
      room_id: "3"

input_boolean:
  vacuum_bootroom:
    name: Boot Room
    icon: mdi:foot-print
  vacuum_livingroom:
    name: Living Room
    icon: mdi:sofa
  vacuum_fronthall:
    name: Front Hall
    icon: mdi:bed-empty
  vacuum_kitchen:
    name: Kitchen
    icon: mdi:silverware-fork-knife
  vacuum_hallway:
    name: Hallway
  vacuum_bathroom:
    name: Bathroom
    icon: mdi:toilet
  vacuum_study:
    name: Study
    icon: mdi:book
  vacuum_craftroom:
    name: Craft Room
    icon: mdi:book
  vacuum_guestroom:
    name: Guest Room
    icon: mdi:bed
  vacuum_bedroom:
    name: Bedroom
    icon: mdi:bed
  vacuum_ensuite:
    name: Ensuite
    icon: mdi:toilet


group:
  vacuum_rooms:
    name: Vacuum Rooms
    entities:
      - input_boolean.vacuum_bootroom
      - input_boolean.vacuum_fronthall
      - input_boolean.vacuum_kitchen
      - input_boolean.vacuum_livingroom
      - input_boolean.vacuum_hallway
      - input_boolean.vacuum_bathroom
      - input_boolean.vacuum_study
      - input_boolean.vacuum_craftroom
      - input_boolean.vacuum_guestroom
      - input_boolean.vacuum_bedroom
      - input_boolean.vacuum_ensuite

script:
  vacuum_clean_segments:
    sequence:
    - service: script.turn_on
      target:
        entity_id: script.vacuum_clean_segments_message
      data:
        variables:
          segments: '{{expand("group.vacuum_rooms") | selectattr("state","eq","on")
            | map(attribute="attributes.room_id") | list | to_json}}'
    mode: single
    alias: vacuum_clean_segments
    icon: mdi:arrow-right
  vacuum_clean_segments_message:
    alias: vacuum_clean_segments_message
    sequence:
    - service: mqtt.publish
      data:
        topic: valetudo/ConfusedMeaslyRaccoon/MapSegmentationCapability/clean/set
        payload_template: '{"segment_ids": {{segments}}}'
    mode: single

