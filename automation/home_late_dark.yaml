alias: "Home late night"
trigger:
  - platform: state
    entity_id: group.all_devices
    from: "not_home"
    to: "home"
condition:
  - condition: state
    entity_id: sun.sun
    state: "below_horizon"
  - condition: time
    after: '22:00:00'
  - condition: time
    before: '05:00:00'
  - condition: template
    value_template: "{% if states('sensor.kyle_status') != 'sleeping' and states('sensor.charlotte_status') != 'sleeping' %}true{% else %}false{% endif %}"
action:
  - service: logbook.log
    data_template:
      name: EVENT
      message: "Home late..."
  - service: notify.email_kyle
    data:
      message: "Home late..."
  - service: light.turn_on
    data:
      entity_id: group.hall
      brightness: 100
      transition: 120
      color_temp: 300
  - service: light.turn_on
    data:
      entity_id: group.bedside_lights
  - service: light.turn_on
    data:
      entity_id: group.outside_lights

  - service: alarm_control_panel.alarm_disarm

  - delay:
      minutes: 5
  - service: light.turn_off
    data:
      entity_id: group.outside_lights

